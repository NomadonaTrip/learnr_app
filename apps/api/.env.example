# ============================================
# LearnR Backend Environment Configuration
# ============================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env to version control!

# ============================================
# OpenAI Configuration (REQUIRED)
# ============================================
# Get your API key from: https://platform.openai.com/api-keys
# Note: Requires payment method even for testing
OPENAI_API_KEY=sk-proj-your-key-here

# Optional: Use mock OpenAI for offline development
USE_MOCK_OPENAI=false

# Optional: Override OpenAI API base URL (for testing/mocking)
# OPENAI_API_BASE=http://localhost:8001

# ============================================
# Qdrant Vector Database (REQUIRED)
# ============================================
# Option 1: Local Qdrant (via Docker Compose) - Recommended for dev
QDRANT_URL=http://localhost:6333
QDRANT_API_KEY=  # Leave empty for local Qdrant
QDRANT_TIMEOUT=10  # Connection timeout in seconds

# Option 2: Qdrant Cloud (production)
# Get free cluster at: https://cloud.qdrant.io/
# QDRANT_URL=https://your-cluster.cloud.qdrant.io:6333
# QDRANT_API_KEY=your-qdrant-api-key-here
# QDRANT_TIMEOUT=10

# ============================================
# Database Configuration (REQUIRED)
# ============================================
# Option 1: Supabase (managed PostgreSQL)
# Get from: https://supabase.com/ → Project Settings → Database
DATABASE_URL=postgresql+asyncpg://postgres:your-password@db.xxx.supabase.co:5432/postgres

# Option 2: Local PostgreSQL (via Docker Compose)
# DATABASE_URL=postgresql+asyncpg://learnr:learnr123@localhost:5432/learnr_dev

# Database Connection Pool Settings
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_ECHO=False  # Set True for SQL query logging

# ============================================
# Redis Cache Configuration (REQUIRED)
# ============================================
# Option 1: Local Redis (via Docker Compose) - Recommended for dev
# Note: Local Docker Redis has password "learnr123" (see docker-compose.dev.yml)
REDIS_URL=redis://:learnr123@localhost:6379/0
REDIS_PASSWORD=learnr123

# Option 2: Railway Redis (production)
# REDIS_URL=redis://default:password@redis.railway.internal:6379
# REDIS_PASSWORD=your-production-password

# Option 3: Redis without password (not recommended)
# REDIS_URL=redis://localhost:6379/0
# REDIS_PASSWORD=

# ============================================
# Email Service (REQUIRED for password reset)
# ============================================
# Get API key from: https://sendgrid.com/ → Settings → API Keys
# Must verify sender identity first!
SENDGRID_API_KEY=SG.your-sendgrid-api-key-here
FROM_EMAIL=noreply@learnr.com

# Optional: Use mock email for development (logs instead of sending)
USE_MOCK_EMAIL=false

# ============================================
# Analytics Configuration (OPTIONAL)
# ============================================
# Get from: https://posthog.com/ → Project Settings → API Keys
POSTHOG_API_KEY=phc_your-posthog-key-here
POSTHOG_HOST=https://app.posthog.com
POSTHOG_ENABLED=false  # Set to true to enable analytics in development

# ============================================
# Error Tracking (OPTIONAL)
# ============================================
# Get from: https://sentry.io/ → Project Settings → Client Keys (DSN)
SENTRY_DSN=https://your-key@o123.ingest.sentry.io/123
SENTRY_ENABLED=false  # Set to true to enable error tracking in development

# ============================================
# Application Configuration
# ============================================
# Environment: development, staging, production
ENVIRONMENT=development

# Debug mode (shows detailed error messages)
DEBUG=true

# ⚠️  CRITICAL SECURITY: JWT Secret Key
# Generate a strong secret key with: openssl rand -hex 32
# NEVER use the default value in production - this is a major security risk!
# The secret key below is ONLY for local development and testing.
SECRET_KEY=your-secret-key-for-jwt-signing-change-this-in-production

# JWT algorithm for token signing
JWT_ALGORITHM=HS256

# JWT expiration (in seconds, 7 days = 604800)
JWT_EXPIRATION_SECONDS=604800

# Frontend URL (for CORS and email links)
FRONTEND_URL=http://localhost:5173

# API URL (for internal service calls)
API_URL=http://localhost:8000

# ============================================
# Rate Limiting
# ============================================
# General API rate limit: Max requests per minute per IP address
RATE_LIMIT_PER_MINUTE=60

# Registration endpoint rate limit: Max registration attempts per minute per IP
# Format: "number/timeunit" (e.g., "5/minute", "10/hour", "100/day")
REGISTRATION_RATE_LIMIT=5/minute

# Max password reset requests per hour per IP
PASSWORD_RESET_RATE_LIMIT=5

# ============================================
# Background Jobs (Celery)
# ============================================
# Celery broker (uses Redis)
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/1

# ============================================
# Testing Configuration (for pytest)
# ============================================
# Test database (separate from development)
TEST_DATABASE_URL=postgresql+asyncpg://learnr:learnr123@localhost:5432/learnr_test

# Use mocks for external services in tests
USE_MOCK_OPENAI_IN_TESTS=true
USE_MOCK_EMAIL_IN_TESTS=true

# ============================================
# Logging Configuration
# ============================================
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Log to file (optional, logs to console by default)
# LOG_FILE=logs/app.log

# ============================================
# AWS S3 Configuration (OPTIONAL - for file storage)
# ============================================
# AWS_ACCESS_KEY_ID=your-aws-access-key
# AWS_SECRET_ACCESS_KEY=your-aws-secret-key
# AWS_S3_BUCKET=learnr-dev
# AWS_REGION=us-east-1
